{% import 'components/form/fields_macros.html.twig' as fields %}

{% set pending_item = call('PendingReason_Item::getForItem', [subitem, true]) %}
{% if subitem.isNewItem() or pending_item or call('PendingReason_Item::isLastTimelineItem', [subitem])  %}
   <div class="row">
      <div class="col-12 col-sm-4" title="{{ "PendingReason"|itemtype_name }}"
           data-bs-toggle="tooltip" data-bs-placement="top">
         {% set pendingreasons_lbl %}
            <i class="fas fa-tags fa-fw"></i>
         {% endset %}
         {% set pending_reasons_id_script %}
            <script>
               var myCollapsible = $('#pending-reasons-setup-{{ rand }}')[0];
               myCollapsible.addEventListener('show.bs.collapse', function () {
                  $('#pending-reasons-control-{{ rand }}').addClass('flex-fill');
               });
               myCollapsible.addEventListener('hide.bs.collapse', function () {
                  $('#pending-reasons-control-{{ rand }}').removeClass('flex-fill');
               });
            </script>
         {% endset %}
         {{ fields.dropdownField(
            'PendingReason',
            'pendingreasons_id',
            subitem.fields['pendingreasons_id'],
            pendingreasons_lbl,
            {
               'label_class': 'col-1',
               'input_class': 'col-10 ms-1',
               'rand': rand,
               'mb': '',
               'hide_if_no_elements': true,
               'addicon': false,
               'comments': false,
               'width': '95%',
               'field_class': '',
               'add_field_html': pending_reasons_id_script
            }
         ) }}
         <script>
            $('#dropdown_pendingreasons_id{{ rand }}').change(function() {
               if ($(this).val() > 0) {
                  $('#pending-reasons-more_options_{{ rand }}').addClass('show');
               } else {
                  $('#pending-reasons-more_options_{{ rand }}').removeClass('show');
               }
            });
         </script>
      </div>

      <div class="collapse col-12 col-sm-8" id="pending-reasons-more_options_{{ rand }}">
         <div class="row">
            <div class="col-12 col-sm-6" title="{{ __('Automatic follow-up') }}"
                  data-bs-toggle="tooltip" data-bs-placement="top">
               {% set pendingreasons_frequency_field = call('PendingReason::displayFollowupFrequencyfield', [
                  pending_item.fields["followup_frequency"],
                  "",
                  [],
                  false
               ]) %}
               {% set pendingreasons_frequency_lbl %}
                  <i class="fas fa-redo fa-fw"></i>
               {% endset %}
               {{ fields.field(
                  'followup_frequency',
                  pendingreasons_frequency_field,
                  pendingreasons_frequency_lbl,
                  {
                     'field_class': '',
                     'label_class': 'col-1',
                     'input_class': 'col-10 ms-1',
                     'rand': rand,
                     'mb': '',
                  }
               ) }}
            </div>
            <div class="col-12 col-sm-6" title="{{ __('Automatic resolution') }}"
                 data-bs-toggle="tooltip" data-bs-placement="top">
               {% set pendingreasons_resolution_field = call('PendingReason::displayFollowupsNumberBeforeResolutionField', [
                     pending_item.fields["followups_before_resolution"],
                     "",
                     [],
                     false
               ]) %}
               {% set pendingreasons_resolution_lbl %}
                  <i class="fas fa-check fa-fw"></i>
               {% endset %}
               {{ fields.field(
                  'followups_before_resolution',
                  pendingreasons_resolution_field,
                  pendingreasons_resolution_lbl,
                  {
                     'field_class': '',
                     'label_class': 'col-1',
                     'input_class': 'col-10 ms-1',
                     'rand': rand,
                     'mb': '',
                  }
               ) }}
            </div>
         </div>
      </div>
   </div>
{% endif %}
