{% extends "generic_show_form.html.twig" %}
{% import 'components/form/fields_macros.html.twig' as fields %}
{# {% import 'components/form/basic_inputs_macros.html.twig' as inputs %} #}

{# {% set params  = params ?? [] %} #}
{# {% set edit_mode = edit_mode|default(false) %} #}

{# {% block form_fields %} #}

{% block more_fields %}
    {# slm #}
    {{ fields.dropdownField('SLM', 'slm', item.fields['slms_id'], __('SLM'), {'disabled': true}) }}

    {# lastupdate #}
    {{ fields.datetimeField('last_update', item.fields['date_mod'], __('Last update'), {'disabled': true}) }}

    {# type #}
    {{ fields.dropdownArrayField(
        'type',
        item.fields['type'],
        item.getTypes(),
        __('Type')
    ) }}

    {# maximumtime #}
    {{ fields.dropdownArrayField(
        'number_time',
        item.fields['number_time'],
        range(0, 1000),
        ''
    ) }}

    {# @todo doesn't work, apply on group dropdown autogenerated, id is ok, but hidden #}
    {% do call('Html::showToolTip', [__('Actions done by users of this group will trigger the TTO/TTR.'), {
        'applyto': 'dropdown_groups_id' ~ rand,
    }]) %}

    {# definition_time #}
    {{ fields.dropdownArrayField(
        'definition_time',
        item.fields['definition_time'],
        item.getDefinitionTimeValues(),
        __('Frequency'),
        {
            'rand': rand
        }
    ) }}
    {% set definition_time_dom_id = 'dropdown_definition_time' ~ rand %}

    {{ fields.dropdownYesNo(
        'end_of_working_day',
        item.fields['end_of_working_day'],
        __('End of working day'),
        {
            'rand': rand
        }
    ) }}
    {% set end_of_working_day_dom_id = 'dropdown_end_of_working_day' ~ rand %}

    <div class="text-center">
        {{ item.showFormWarning() }}
    </div>

    {# javascript to hide/show end_of_working_day #}
    <script>
        $(function () {
                const hideShowEndOfWorkingDay = () => {
                    console.log('yep');
                    let selectedValue = $('#{{ definition_time_dom_id }}').val();
                    if (selectedValue === 'day' || selectedValue === 'month') {
                        $('#{{ end_of_working_day_dom_id }}').parent().parent().show();
                    } else {
                        $('#{{ end_of_working_day_dom_id }}').parent().parent().hide();
                    }
                };
                hideShowEndOfWorkingDay();
                $('#{{ definition_time_dom_id }}').on('change', hideShowEndOfWorkingDay);
            }
        );
    </script>

{% endblock %}